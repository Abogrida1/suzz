<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Suzz - Gift & Admin</title>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- QRCode.js -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <!-- html5-qrcode -->
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    .discount-badge {
      background: linear-gradient(135deg, #fdc830 0%, #f37335 100%);
    }
    #qr-reader {
      width: 100% !important;
    }
    #qr-reader__dashboard_section {
      padding: 10px !important;
    }
    .qr-code-container {
      margin: 0 auto;
      padding: 15px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: inline-block;
    }
  </style>
</head>
<body class="gradient-bg min-h-screen flex flex-col">

  <!-- Logo -->
  <div class="flex justify-center mt-4">
    <img src="/static/logo.jpg" 
         alt="Suzz Logo" 
         class="w-40 md:w-56 lg:w-64 h-auto rounded-full shadow-lg border-4 border-white"
         onerror="this.src='https://placehold.co/600x400?text=Suzz+Logo&font=roboto'">
  </div>

  <!-- Navigation -->
  <nav class="bg-white shadow-lg p-4 flex flex-col md:flex-row justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800 mb-2 md:mb-0 font-serif">Suzz</h1>
    <div class="flex flex-col sm:flex-row gap-2">
      <button id="btn-client" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-300 shadow-md">
        Client Page
      </button>
      <button id="btn-admin" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">
        Admin Page
      </button>
    </div>
  </nav>

  <!-- Client Page -->
  <main id="client-page" class="flex-grow p-4 md:p-6 max-w-4xl mx-auto w-full">
    <section class="bg-white rounded-xl shadow-lg p-4 md:p-6 backdrop-blur-sm bg-opacity-90">
      <h2 class="text-3xl font-semibold mb-4 text-center text-gray-800 font-serif">Welcome to Suzz!</h2>
      
      <!-- Coffee Image -->
      <div class="flex justify-center mb-6">
        <img src="/static/coffee_offer.jpg" 
             alt="Special offer from Suzz" 
             class="rounded-xl shadow-md w-full max-w-lg h-auto object-cover"
             style="max-height: 300px;"
             onerror="this.src='https://placehold.co/600x300?text=Special+Offer&font=roboto'">
      </div>
      
      <p class="mb-4 text-gray-700 text-center text-lg">Claim your special gift discount now!</p>
      
      <!-- Phone Input -->
      <div class="mb-4">
        <label for="phone-input" class="block mb-2 font-medium text-gray-800">Enter your phone number:</label>
        <input type="tel" id="phone-input" placeholder="e.g. 01012345678" 
               class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        <p id="phone-error" class="text-red-600 mt-1 hidden">Please enter a valid Egyptian phone number (11 digits starting with 01)</p>
      </div>
      
      <button id="claim-gift-btn" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-300 shadow-md transform hover:scale-105">
        Claim Gift
      </button>

      <!-- Discount Section -->
      <div id="discount-section" class="mt-6 hidden p-6 border-2 border-green-400 rounded-xl bg-green-50">
        <h3 class="text-2xl font-semibold mb-4 text-center text-green-800">Your Exclusive Discount!</h3>
        <div class="discount-badge text-white text-5xl font-bold text-center rounded-full w-32 h-32 mx-auto flex items-center justify-center shadow-lg mb-6">
          <span id="discount-value"></span>
        </div>
        <p class="text-center text-gray-700 mb-4">Show this QR code at our cafe:</p>
        
        <div class="flex flex-col items-center">
          <div id="qrcode" class="qr-code-container mb-4"></div>
          <p id="code-text" class="text-center font-mono bg-gray-100 p-2 rounded-lg"></p>
        </div>
        
        <p class="text-center text-sm text-gray-500 italic mt-4">This code can only be used once. Valid for 7 days.</p>
      </div>

      <!-- OTP Section -->
      <div id="otp-section" class="mt-6 hidden p-6 border-2 border-blue-400 rounded-xl bg-blue-50">
        <h3 class="text-2xl font-semibold mb-4 text-center text-blue-800">WhatsApp Verification</h3>
        <p class="mb-4 text-gray-700 text-center">We've sent a 6-digit OTP code to your WhatsApp.</p>
        
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <input type="text" id="otp-input" maxlength="6" placeholder="Enter OTP" 
                 class="w-full sm:w-48 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-xl">
          <button id="verify-otp-btn" class="w-full sm:w-auto px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-300 shadow-md">
            Verify OTP
          </button>
        </div>
        
        <p id="otp-error" class="text-red-600 mt-3 text-center hidden">Invalid OTP. Please try again.</p>
        <p id="otp-success" class="text-green-600 mt-3 text-center hidden">Phone number verified successfully!</p>
        <p id="otp-timer" class="text-gray-500 mt-3 text-center hidden">Didn't receive code? <span id="countdown">60</span>s</p>
      </div>

      <!-- Existing Code Section -->
      <div id="existing-code-section" class="mt-6 hidden p-6 border-2 border-purple-400 rounded-xl bg-purple-50">
        <h3 class="text-2xl font-semibold mb-4 text-center text-purple-800">Your Existing Discount</h3>
        <p class="mb-4 text-gray-700 text-center">You already have an unused discount code.</p>
        
        <div class="flex flex-col items-center">
          <div id="existing-qrcode" class="qr-code-container mb-4"></div>
          <p id="existing-code-text" class="text-center font-mono bg-gray-100 p-2 rounded-lg"></p>
        </div>
        
        <p class="text-center text-sm text-gray-500 italic">This code is still valid and can be used once.</p>
      </div>
    </section>
  </main>

  <!-- Admin Page -->
  <main id="admin-page" class="hidden flex-grow p-4 md:p-6 max-w-6xl mx-auto w-full">
    <section class="bg-white rounded-xl shadow-lg p-4 md:p-6">
      <h2 class="text-3xl font-semibold mb-6 text-center text-gray-800 font-serif">Admin Dashboard</h2>
      
      <!-- Admin Login -->
      <div id="admin-login-section">
        <div class="max-w-md mx-auto bg-gray-100 p-6 rounded-lg">
          <label for="admin-password" class="block mb-2 font-medium text-gray-800">Enter Admin Password:</label>
          <div class="flex flex-col sm:flex-row items-center gap-4">
            <input type="password" id="admin-password" placeholder="Password" 
                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="admin-login-btn" class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">
              Login
            </button>
          </div>
          <p id="admin-login-error" class="text-red-600 mt-2 text-center hidden">Incorrect password. Please try again.</p>
        </div>
      </div>

      <!-- Admin Dashboard -->
      <div id="admin-dashboard" class="hidden">
        <div class="flex justify-between items-center mb-6">
          <button id="logout-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300 shadow-md">
            Logout
          </button>
          <p class="text-gray-600">Logged in as Admin</p>
        </div>
        
        <!-- QR Scanner Section -->
        <div class="bg-gray-100 p-6 rounded-lg mb-6">
          <h3 class="text-xl font-semibold mb-4">Redeem Discount Code</h3>
          
          <div class="grid md:grid-cols-2 gap-6">
            <!-- QR Scanner -->
            <div>
              <h4 class="font-medium mb-2">Scan QR Code:</h4>
              <div id="qr-reader" class="mb-4 border-2 border-gray-300 rounded-lg overflow-hidden"></div>
            </div>
            
            <!-- Manual Entry -->
            <div>
              <h4 class="font-medium mb-2">Or Enter Code Manually:</h4>
              <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="manual-code-input" placeholder="Enter discount code" 
                       class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="submit-code-btn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">
                  Submit
                </button>
              </div>
            </div>
          </div>
          
          <div id="scan-result" class="mt-4 p-4 rounded-lg border border-gray-300 bg-white"></div>
        </div>
        
        <!-- All Codes Table -->
        <div class="bg-gray-100 p-6 rounded-lg">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">All Generated Codes</h3>
            <button id="refresh-codes-btn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition duration-300 shadow-md">
              Refresh
            </button>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full border-collapse border border-gray-300 text-left text-sm bg-white rounded-lg overflow-hidden">
              <thead>
                <tr class="bg-gray-800 text-white">
                  <th class="border border-gray-300 p-3">Phone</th>
                  <th class="border border-gray-300 p-3">Discount</th>
                  <th class="border border-gray-300 p-3">Code</th>
                  <th class="border border-gray-300 p-3">Status</th>
                  <th class="border border-gray-300 p-3">Time</th>
                </tr>
              </thead>
              <tbody id="codes-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ======================
    // Utility Functions
    // ======================
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    function generateQRCode(container, text, options = {}) {
      container.innerHTML = '';
      const defaultOptions = {
        width: 200,
        margin: 1,
        color: {
          dark: '#000000',
          light: '#ffffff'
        }
      };
      
      QRCode.toCanvas(container, text, {...defaultOptions, ...options}, (error) => {
        if (error) {
          console.error('QR Code generation error:', error);
          container.innerHTML = '<p class="text-red-500">Failed to generate QR code</p>';
        }
      });
    }

    function formatPhoneNumber(phone) {
      return phone.replace(/\D/g, '').replace(/(\d{3})(\d{4})(\d{4})/, '$1 $2 $3');
    }

    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      return new Date(dateString).toLocaleDateString('en-US', options);
    }

    // ======================
    // State Management
    // ======================
    const STORAGE_KEY_CODES = 'suzz_codes_v2';
    const ADMIN_PASSWORD = 'admin123'; // Change this in production!
    
    let currentDiscount = null;
    let currentPhoneNumber = null;
    let currentOtp = null;
    let otpSent = false;
    let html5QrCode = null;
    let countdownInterval = null;

    // ======================
    // DOM Elements
    // ======================
    // Client Page
    const clientPage = document.getElementById('client-page');
    const adminPage = document.getElementById('admin-page');
    const btnClient = document.getElementById('btn-client');
    const btnAdmin = document.getElementById('btn-admin');
    const phoneInput = document.getElementById('phone-input');
    const phoneError = document.getElementById('phone-error');
    const claimGiftBtn = document.getElementById('claim-gift-btn');
    const discountSection = document.getElementById('discount-section');
    const discountValue = document.getElementById('discount-value');
    const qrcodeContainer = document.getElementById('qrcode');
    const codeText = document.getElementById('code-text');
    const otpSection = document.getElementById('otp-section');
    const otpInput = document.getElementById('otp-input');
    const verifyOtpBtn = document.getElementById('verify-otp-btn');
    const otpError = document.getElementById('otp-error');
    const otpSuccess = document.getElementById('otp-success');
    const otpTimer = document.getElementById('otp-timer');
    const countdown = document.getElementById('countdown');
    const existingCodeSection = document.getElementById('existing-code-section');
    const existingQrcodeContainer = document.getElementById('existing-qrcode');
    const existingCodeText = document.getElementById('existing-code-text');

    // Admin Page
    const adminLoginSection = document.getElementById('admin-login-section');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminLoginBtn = document.getElementById('admin-login-btn');
    const adminLoginError = document.getElementById('admin-login-error');
    const adminDashboard = document.getElementById('admin-dashboard');
    const logoutBtn = document.getElementById('logout-btn');
    const qrReader = document.getElementById('qr-reader');
    const manualCodeInput = document.getElementById('manual-code-input');
    const submitCodeBtn = document.getElementById('submit-code-btn');
    const scanResult = document.getElementById('scan-result');
    const codesTableBody = document.getElementById('codes-table-body');
    const refreshCodesBtn = document.getElementById('refresh-codes-btn');

    // ======================
    // Core Functions
    // ======================
    function validatePhoneNumber(phone) {
      const digitsOnly = phone.replace(/\D/g, '');
      return digitsOnly.length === 11 && digitsOnly.startsWith('01');
    }

    function generateRandomDiscount() {
      const discounts = [10, 15, 20, 25, 30, 35, 40];
      return discounts[Math.floor(Math.random() * discounts.length)];
    }

    function generateUniqueCode() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let result = '';
      for (let i = 0; i < 8; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    function saveCodeData(phone, discount, code) {
      const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || [];
      const timestamp = new Date().toISOString();
      
      codes.push({ 
        phone, 
        discount, 
        code, 
        used: false, 
        verified: false,
        timestamp
      });
      
      localStorage.setItem(STORAGE_KEY_CODES, JSON.stringify(codes));
      return codes[codes.length - 1];
    }

    function updateCodeData(code, updates) {
      const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || []);
      const index = codes.findIndex(c => c.code === code);
      
      if (index !== -1) {
        codes[index] = { ...codes[index], ...updates };
        localStorage.setItem(STORAGE_KEY_CODES, JSON.stringify(codes));
        return codes[index];
      }
      return null;
    }

    function getUnusedCode(phone) {
      const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || []);
      return codes.find(c => c.phone === phone && !c.used);
    }

    function hasUsedCode(phone) {
      const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || []);
      return codes.some(c => c.phone === phone && c.used);
    }

    function startCountdown() {
      let seconds = 60;
      otpTimer.classList.remove('hidden');
      countdown.textContent = seconds;
      
      countdownInterval = setInterval(() => {
        seconds--;
        countdown.textContent = seconds;
        
        if (seconds <= 0) {
          clearInterval(countdownInterval);
          otpTimer.classList.add('hidden');
        }
      }, 1000);
    }

    function resetCountdown() {
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }
      otpTimer.classList.add('hidden');
    }

    function resetClientPage() {
      phoneInput.value = '';
      phoneError.classList.add('hidden');
      discountSection.classList.add('hidden');
      discountValue.textContent = '';
      qrcodeContainer.innerHTML = '';
      codeText.textContent = '';
      otpSection.classList.add('hidden');
      otpInput.value = '';
      otpError.classList.add('hidden');
      otpSuccess.classList.add('hidden');
      existingCodeSection.classList.add('hidden');
      existingQrcodeContainer.innerHTML = '';
      existingCodeText.textContent = '';
      resetCountdown();
      
      currentDiscount = null;
      currentPhoneNumber = null;
      currentOtp = null;
      otpSent = false;
    }

    function resetAdminPage() {
      adminPasswordInput.value = '';
      adminLoginError.classList.add('hidden');
      adminLoginSection.classList.remove('hidden');
      adminDashboard.classList.add('hidden');
      scanResult.textContent = '';
      codesTableBody.innerHTML = '';
      manualCodeInput.value = '';
      
      if (html5QrCode) {
        html5QrCode.stop().catch(() => {});
        html5QrCode = null;
      }
    }

    function showExistingCode(code) {
      existingCodeSection.classList.remove('hidden');
      generateQRCode(existingQrcodeContainer, code.code);
      existingCodeText.textContent = code.code;
    }

    function showDiscountSection(code) {
      discountValue.textContent = code.discount + '%';
      generateQRCode(qrcodeContainer, code.code);
      codeText.textContent = code.code;
      discountSection.classList.remove('hidden');
      otpSection.classList.add('hidden');
    }

    function showErrorMessage(message, isAdmin = false) {
      const container = isAdmin ? adminDashboard : clientPage;
      let errorDiv = container.querySelector('#error-message');
      
      if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.id = 'error-message';
        errorDiv.className = 'mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-center';
        container.querySelector('section').prepend(errorDiv);
      }
      
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    async function sendWhatsAppOtp(phone) {
      const fullPhone = '+20' + phone.replace(/\D/g, '').substring(1);
      currentOtp = Math.floor(100000 + Math.random() * 900000).toString();

      // In a real app, you would send this via Green API
      console.log(`Would send OTP ${currentOtp} to ${fullPhone}`);
      
      // Simulate API delay
      return new Promise(resolve => setTimeout(resolve, 1000));
    }

    function loadCodesTable() {
      const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || []);
      codesTableBody.innerHTML = '';
      
      codes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(code => {
        const tr = document.createElement('tr');
        tr.classList.add('hover:bg-gray-50');
        
        const statusClass = code.used ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800';
        const statusText = code.used ? 'Used' : 'Active';
        
        tr.innerHTML = `
          <td class="border border-gray-300 p-3">${formatPhoneNumber(code.phone)}</td>
          <td class="border border-gray-300 p-3 text-center">${code.discount}%</td>
          <td class="border border-gray-300 p-3 font-mono">${code.code}</td>
          <td class="border border-gray-300 p-3">
            <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">${statusText}</span>
          </td>
          <td class="border border-gray-300 p-3 text-sm">${formatDate(code.timestamp)}</td>
        `;
        
        codesTableBody.appendChild(tr);
      });
    }

    function startQrScanner() {
      if (html5QrCode) {
        html5QrCode.stop().catch(() => {});
      }
      
      html5QrCode = new Html5Qrcode("qr-reader");
      const config = { fps: 10, qrbox: 250 };
      
      html5QrCode.start(
        { facingMode: "environment" },
        config,
        qrCodeMessage => {
          handleScannedCode(qrCodeMessage);
        },
        errorMessage => {
          // Ignore scanning errors
        }
      ).catch(err => {
        scanResult.innerHTML = `
          <p class="text-red-600">Camera error: ${err.message}</p>
          <p class="text-gray-600 mt-2">Please use manual code entry</p>
        `;
      });
    }

    function handleScannedCode(code) {
      const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || []);
      const found = codes.find(c => c.code === code);
      
      if (!found) {
        scanResult.innerHTML = `
          <p class="text-red-600 font-bold">Invalid Code</p>
          <p class="text-gray-600 mt-1">This QR code is not recognized</p>
        `;
        return;
      }
      
      if (found.used) {
        scanResult.innerHTML = `
          <p class="text-yellow-600 font-bold">Already Used</p>
          <p class="mt-1">Phone: ${formatPhoneNumber(found.phone)}</p>
          <p>Discount: ${found.discount}%</p>
          <p class="text-sm text-gray-500 mt-1">Used on: ${formatDate(found.timestamp)}</p>
        `;
        return;
      }
      
      // Mark as used
      const updatedCode = updateCodeData(found.code, { 
        used: true, 
        timestamp: new Date().toISOString() 
      });
      
      scanResult.innerHTML = `
        <p class="text-green-600 font-bold">Successfully Redeemed!</p>
        <p class="mt-2">Phone: ${formatPhoneNumber(updatedCode.phone)}</p>
        <p>Discount: ${updatedCode.discount}%</p>
        <p class="text-sm text-gray-500 mt-2">Time: ${formatDate(updatedCode.timestamp)}</p>
      `;
      
      loadCodesTable();
    }

    function handleManualCodeSubmit() {
      const code = manualCodeInput.value.trim();
      if (!code) {
        scanResult.innerHTML = `
          <p class="text-red-600">Please enter a code</p>
        `;
        return;
      }
      
      handleScannedCode(code);
      manualCodeInput.value = '';
    }

    // ======================
    // Event Listeners
    // ======================
    btnClient.addEventListener('click', () => {
      clientPage.classList.remove('hidden');
      adminPage.classList.add('hidden');
      resetClientPage();
    });

    btnAdmin.addEventListener('click', () => {
      clientPage.classList.add('hidden');
      adminPage.classList.remove('hidden');
      resetAdminPage();
    });

    claimGiftBtn.addEventListener('click', async () => {
      const phone = phoneInput.value.trim();
      
      if (!validatePhoneNumber(phone)) {
        phoneError.classList.remove('hidden');
        return;
      }
      
      phoneError.classList.add('hidden');
      currentPhoneNumber = phone;

      // Check for existing unused code
      const existingCode = getUnusedCode(phone);
      if (existingCode) {
        showExistingCode(existingCode);
        return;
      }

      // Check if already used
      if (hasUsedCode(phone)) {
        showErrorMessage('This number has already used a discount.');
        return;
      }

      // Generate new discount
      currentDiscount = generateRandomDiscount();
      const newCode = generateUniqueCode();
      saveCodeData(phone, currentDiscount, newCode);

      // Send OTP
      try {
        await sendWhatsAppOtp(phone);
        otpSection.classList.remove('hidden');
        otpSent = true;
        startCountdown();
      } catch (err) {
        showErrorMessage('Failed to send OTP. Please try again.');
        console.error(err);
      }
    });

    verifyOtpBtn.addEventListener('click', () => {
      const enteredOtp = otpInput.value.trim();
      
      if (enteredOtp === currentOtp) {
        otpError.classList.add('hidden');
        otpSuccess.classList.remove('hidden');
        resetCountdown();

        // Mark as verified and show discount
        const codes = JSON.parse(localStorage.getItem(STORAGE_KEY_CODES) || []);
        const code = codes.find(c => c.phone === currentPhoneNumber && !c.used);
        
        if (code) {
          updateCodeData(code.code, { verified: true });
          showDiscountSection(code);
        }
      } else {
        otpError.classList.remove('hidden');
        otpSuccess.classList.add('hidden');
      }
    });

    adminLoginBtn.addEventListener('click', async () => {
      const enteredPassword = adminPasswordInput.value;
      
      if (enteredPassword === ADMIN_PASSWORD) {
        adminLoginError.classList.add('hidden');
        adminLoginSection.classList.add('hidden');
        adminDashboard.classList.remove('hidden');
        startQrScanner();
        loadCodesTable();
      } else {
        adminLoginError.classList.remove('hidden');
      }
    });

    logoutBtn.addEventListener('click', () => {
      resetAdminPage();
    });

    submitCodeBtn.addEventListener('click', handleManualCodeSubmit);
    manualCodeInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleManualCodeSubmit();
    });

    refreshCodesBtn.addEventListener('click', loadCodesTable);

    // Initialize
    window.addEventListener('load', () => {
      btnClient.click();
      phoneInput.focus();
    });
  </script>
</body>
</html>
